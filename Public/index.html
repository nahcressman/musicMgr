<!DOCTYPE html>
<html>
	<head>
		<script src="https://unpkg.com/react@15.3.2/dist/react.min.js"></script>
		<script src="https://unpkg.com/react-dom@15.3.2/dist/react-dom.min.js"></script>
		<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
		<script src="./script/jquery-3.1.1.min.js"></script>

	</head>
	<body>
		<div id="content"></div>
		<script type="text/babel">
			var SearchForm = React.createClass({
				getInitialState: function() {
					return {queryText: ""};
				},
				handleSearchBoxChange: function(e) {
					this.setState({queryText: e.target.value});
				},
				handleSubmit: function(e) {
					e.preventDefault();
					var queryText = this.state.queryText.trim();
					if(!queryText) {
						return;
					}
					this.props.onQuerySubmit(queryText);
				},
				render: function() {
					return (	
						<form class="SearchForm" onSubmit={this.handleSubmit}>				
							<label for="searchBox">Search: </label>
							<input id="searchBox" type="text" onChange={this.handleSearchBoxChange} value = {this.state.queryText}/>
							<input type="submit" value="Go"/>
						</form>
					);
				}
			});
			var ResultList = React.createClass({
				render: function() {
					var resultSet = this.props.results.map(function (result) {
						return (
							<div>{result.name}: {result.popularity}</div>
						);
					});
					return (
						<div className="resultSet">
							<h3>{this.props.type}</h3>
							{resultSet}
						</div>
					);
				}
			});
			var SearchInterface = React.createClass({
				getInitialState: function() {
					return {
						trackResults: [],
						albumResults: [],
						artistResults: []
					};
				},
				handleQuerySubmit: function(query) {
					var si = this;
					console.log(`Sending request to ${this.props.url} with these parameters:`);
					console.log(`${query}`);
					$.get(this.props.url, {q: query}, function(data) {
						si.setState({
							trackResults: data.tracks,
							albumResults: data.albums,
							artistResults: data.artists
						});
					});
				},
				render: function() {					
					return (
						<div class="wrapper">
							<SearchForm onQuerySubmit={this.handleQuerySubmit}/>
							<ResultList type="artists" results={this.state.artistResults}/>
							<ResultList type="tracks" results={this.state.trackResults}/>
							<ResultList type="albums" results={this.state.albumResults}/>
						</div>
					);
				}
			});
			ReactDOM.render(React.createElement(SearchInterface, {url: "/search"}, "Hello World"), document.getElementById("content"));
		</script>
	</body>
</html>	